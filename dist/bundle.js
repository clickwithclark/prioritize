(()=>{"use strict";function e(){return JSON.parse(localStorage.getItem("state"))}function t(e){localStorage.setItem("state",JSON.stringify(e))}function o(){const t={...{...e()}?.todos};return 0===Object.keys(t).length?(document.querySelector("#todoList").style.opacity="0.5",{2592696:{id:2592696,message:"Pay electric bill",date:"2021-03-30T02:05:02.587Z",category:null,completed:!1},12462012:{id:"12462012",message:" feed dog",date:"2021-03-30T02:04:30.913Z",category:"Chores",completed:!1},41152409:{id:41152409,message:"cheese",date:"2021-03-30T02:03:53.599Z",category:"Grocery",completed:!1},53541349:{id:53541349,message:"milk",date:"2021-03-30T02:03:53.599Z",category:"Grocery",completed:!1},95110512:{id:95110512,message:" dishes",date:"2021-03-30T02:04:20.509Z",category:"Chores",completed:!1},98802921:{id:"98802921",message:"fix Timmy's bicycle",date:"2021-03-30T02:12:28.203Z",category:null,completed:!1}}):t}function n(o){const n={...e()},r={...n?.todos};if(0===Object.keys(r).length)return;let s=r[o.id];s={...s,...o},Object.assign(r,{[s.id]:s}),n.todos=r,t(n)}function r(o){const n={...e()},r=[];o.forEach((e=>{r.push(+e[0])})),n.order=r,t(n)}function s(){const o=e();o.updateConfig=null,t(o)}const c=document.querySelector("#todoList");function a(e){const t=document.createElement("li");t.draggable="true";const o=document.createElement("span"),n=document.createElement("i"),r=document.createElement("span"),s=document.createElement("i"),a=document.createElement("span"),i=document.createElement("i"),d=document.createElement("span");o.appendChild(n),r.className="grip",a.className="edit",o.className="checkmark",r.appendChild(s),a.appendChild(i),i.className="fas fa-edit",s.className="fas fa-arrows-alt-v",n.className="far fa-check-square",d.className="main-message",t.appendChild(d),t.dataset.id=e.id,d.innerText=e.category?`[${e.category}] ${e.message}`:`${e.message}`,e.completed&&(d.classList.add("completed"),o.classList.add("show-checkmark")),t.insertAdjacentElement("afterbegin",o),t.insertAdjacentElement("beforeend",r),t.insertAdjacentElement("beforeend",a),c.append(t)}const i=function(){const o=[...document.querySelectorAll("li")],n=[...document.querySelectorAll("[data-draggable-container]")];o.forEach((o=>{o.addEventListener("dragstart",(()=>{o.classList.add("dragging")})),o.addEventListener("dragend",(()=>{document.querySelector("#todoList").style.cursor="default",o.classList.remove("dragging"),function(){const o=[...document.querySelectorAll("li")],n=[];o.forEach((e=>{n.push(+e.dataset.id)}));const r=e();n.length>0&&(r.order=n,t(r))}()}))})),n.forEach((e=>{e.addEventListener("dragover",(t=>{t.preventDefault();const o=function(e,t){return[...e.querySelectorAll('[draggable="true"]:not(.dragging)')].reduce(((e,o)=>{const n=o.getBoundingClientRect(),r=t-n.top-n.height/2;return r<0&&r>e.offset?{offset:r,element:o}:e}),{offset:Number.NEGATIVE_INFINITY}).element}(e,t.clientY),n=document.querySelector(".dragging");n.opacity="0.5",null!=o?e.insertBefore(n,o):e.appendChild(n)}))}))};function d(e,t=3){const o=document.querySelector(".bubble"),n=document.querySelector(".info-message"),r=document.querySelector("#logo");window.scrollTo({top:0,behavior:"smooth"}),r.src="../assets/img/oops.png",o.style.visibility="visible",n.textContent=e.message,setTimeout((()=>{o.style.visibility="hidden",n.textContent="",r.src="",r.src="../assets/img/cwc.png"}),1e3*t)}function l(){document.querySelector("#todoList").innerHTML="";const t=o(),n=e()?.order??[];try{if(0===n.length)return Object.keys(t).forEach((e=>{a(t[e])})),void i();n.forEach((e=>{a(t[+e])})),i()}catch(e){d(e),console.trace()}}function u(o){const n=document.querySelector("#todoInput"),r=o.target.closest("li"),{id:s}=r.dataset,c=r.offsetTop,a=document.querySelector("h1").offsetTop,i=r.querySelector(".main-message"),d=i.innerText;if(i.classList.contains("completed"))return l();let u=i.innerText.replace("[","(");u=u.replace("]",")"),n.value=u,n.classList.add("editing-in-progress"),n.classList.add("pop-out-fade-out"),n.placeholder=`Updating: ${d.slice(0,16)}...ðŸ“‘`,window.scrollTo({top:a,behavior:"smooth"}),n.focus();const g={};g.id=+s,function(o){const n=e();n.updateConfig=o,t(n)}({todoOffset:c,updatedTodo:g})}function g(e){return e[0].toUpperCase()+e.slice(1)}function m(e){let t=null,o=e;-1!==e.indexOf("(")&&(t=e.match(/\((.*)\)/).pop(),o=e.replace(`(${t})`,"").trim());try{if(0===o.length)throw new Error("Task left blank during multi-entry mode\n      Example:   task1, ,task2");return o=g(o),t&&(t=g(t)),console.log("todo still built"),{id:Math.floor(1e8*Math.random()),message:o,date:new Date,category:t,completed:!1}}catch(e){console.trace(),d(e,7)}}function p(o){const n=m(o);try{if(n)return function(o){const n={...e()},r={...n?.todos};0===Object.keys(r).length&&(document.querySelector("#todoList").style.opacity="1"),Object.assign(r,{[o.id]:o}),n.order=n?.order??[],n.order=[o.id,...n.order],n.todos=r,t(n)}(n),void l()}catch(e){console.trace(),d(e)}}function f(e,t,o){document.addEventListener(e,(e=>{e.target.closest(t)&&o(e)}))}const y=function(e){let t=[],n=1;return{sort(){t=Object.entries(o());try{if(0===t.length)return;t.sort(((e,t)=>{return o=e[1].date,(t[1].date>o?1:-1)*n;var o})),n*=-1}catch(e){console.error(e)}document.querySelector("#todoList").innerHTML="",t.forEach((e=>{a({...e[1]})})),r(t),i()}}}(),h=function(e){let t=[],n=1;return{sort(){t=Object.entries(o());try{if(0===t.length)return;t.sort(((e,t)=>{return o=e[1].category,(t[1].category>o?1:-1)*n;var o})),n*=-1}catch(e){console.error(e)}document.querySelector("#todoList").innerHTML="",t.forEach((e=>{a({...e[1]})})),r(t),i()}}}();function b(e){e.value="",e.placeholder="Add New Task...ðŸ“„",e.classList.remove("editing-in-progress")}function E(){f("keydown","#todoInput",(o=>{if("Enter"===o.key){if(o.target.classList.contains("editing-in-progress")){const o=e()?.updateConfig;if(o){const n=document.querySelector("#todoInput");try{const r=n.value.trim();if(""===r)throw new Error("Woops, update cannot be blank! . . . try deleting it instead");const c=m(r);c.id=o.updatedTodo.id,function(o){const n={...e()},r={...n?.todos};Object.assign(r,{[o.id]:o}),n.todos=r,t(n)}(c),b(n),s(),window.scrollTo({top:o.todoOffset,behavior:"smooth"}),l()}catch(e){console.trace(e),d(e)}}return}try{if(""===o.target.value.trim())throw new Error("Woops, you have to enter something first!");(function(){const e=document.querySelector("#todoInput").value.trim();-1===e.indexOf(",")?p(e):e.split(",").forEach((e=>{p(e)}))})(),o.target.value=""}catch(e){console.trace(e),d(e)}}})),f("focusout","#todoInput",(e=>{b(e.target),s(),l()})),f("pointerup",".edit",u),f("pointerup",".drop-down-entry",(()=>{const e=document.querySelector("#todoInput");e.classList.toggle("pop-out-fade-out"),e.focus()})),f("pointerdown",".grip",(e=>{e.target.style.cursor="grabbing",document.querySelector("#todoList").style.cursor="grabbing"})),f("pointerup","#todoList",(e=>{const t=document.querySelector("#todoList");[...t.querySelectorAll(".grip")].forEach((e=>{e.style.setProperty("cursor","grab")})),t.style.cursor="default"})),f("pointerdown",".main-message",(e=>{const t=e.target;t.classList.contains("editing-in-progress")||(t.classList.toggle("completed"),t.previousElementSibling.classList.toggle("show-checkmark"),function(e){const t=e.target,o=e.target.closest("li"),{id:r}=o.dataset;if(t.classList.contains("completed"))return n({id:r,completed:!0});n({id:r,completed:!1})}(e))})),f("pointerdown",".checkmark",(o=>{const n=o.target.closest("li"),{id:r}=n.dataset;n.style.transition="0.3s",n.style.opacity=0,n.style.marginTop="-40px",function(o){const n={...e()};let r=[...e()?.order];const s={...n?.todos};r=r.filter((e=>e!==o)),delete s[o],n.todos=s,console.log(r),n.order=r,t(n)}(+r),setTimeout((()=>{n.remove(),l()}),400)})),f("pointerdown",".date-sort",y.sort),f("pointerdown",".category-sort",h.sort),l()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",E):E()})();